---
title: "Untitled"
author: "A.J Wing"
date: '2022-06-21'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library("tidyr")
library(readr)
library(dplyr)
library(ggplot2)
library(viridis)
library(ggthemes)
```


## import normalized read counts
```{r}
merged_tpm <- read_tsv("~/Desktop/erie_story_r_work/abund_table_tpm_normalized_clusters_with_metadata.tsv")
```


## create abundance table for diversity analyses
```{r}
abund_table <- merged_tpm[,-c((ncol(merged_tpm)-25):ncol(merged_tpm))]

abund_table_rel <-abund_table/rowSums(abund_table)*100
table(colSums(abund_table_rel)>1)

abund_table <- abund_table[,colSums(abund_table_rel)>=0] #default is 0.1 aka 10%
abund_table_rel <- abund_table_rel[,colnames(abund_table_rel) %in% colnames(abund_table)]

abund_table_pres <- apply(abund_table, c(1,2), function(x) if (x>0) {x=1} else {x=0})

abund_table_order <- abund_table_pres
abund_table_order[,] <- 0

for (i in 1:nrow(abund_table)) {
  ranking <- tibble(order=order(abund_table[i,], decreasing=T),
                    placement=seq(1:ncol(abund_table)))
  for (j in 1:ncol(abund_table)) {
    if (abund_table_pres[i,j]==1)
      abund_table_order[i,j] <- ranking$placement[ranking$order==j]  
  }
}

abund_table_order_bin <- matrix(nrow=nrow(abund_table),
                            ncol=ncol(abund_table), data = 0)

for (i in 1:nrow(abund_table)) {
  num_clusters <- sum(abund_table_pres[i,])
  for (j in 1: ncol(abund_table)) {
    if (abund_table_order[i,j]<=(num_clusters*.1) & abund_table_order[i,j]!=0) 
      abund_table_order_bin[i,j] <- 1
  }
}

table(abund_table_rel>10)
abund_table_order_bin_1percent <- matrix(nrow=nrow(abund_table),
                            ncol=ncol(abund_table), data = 0)

for (i in 1:nrow(abund_table)) {
  for (j in 1: ncol(abund_table)) {
    if (abund_table_rel[i,j]>=1 & abund_table_order[i,j]!=0) 
      abund_table_order_bin_1percent[i,j] <- 1
  }
}

abund_table_order_bin_halfpercent <- matrix(nrow=nrow(abund_table),
                            ncol=ncol(abund_table), data = 0)

for (i in 1:nrow(abund_table)) {
  for (j in 1: ncol(abund_table)) {
    if (abund_table_rel[i,j]>=0.5 & abund_table_order[i,j]!=0) 
      abund_table_order_bin_halfpercent[i,j] <- 1
  }
}

num_samples_contig_in <- tibble(VP_ID=colnames(abund_table_pres),
                                samples_present_in=colSums(abund_table_pres),
                                read_abundance=colSums(abund_table),
                                rank=colSums(abund_table_order_bin),
                                rank1percent=colSums(abund_table_order_bin_1percent),
                                rankhalfpercent=colSums(abund_table_order_bin_halfpercent))

#num_samples_contig_in <- num_samples_contig_in[-c(440,593),]

#write_tsv(num_samples_contig_in, "~/Desktop/erie_story_r_work/num_samples_contig_in.tsv", col_names = TRUE)
```

```{r}
vp_number_dates <- read_tsv("~/Desktop/erie_story_r_work/VP_number_of_sample_dates.tsv")
names(vp_number_dates)[names(vp_number_dates) == 'uniq_VPs'] <- "VP_ID"
```

```{r}
vp_dates_abundances <- left_join(num_samples_contig_in,vp_number_dates,by="VP_ID")
```


```{r}
vp_lengths <- read_tsv("~/Desktop/erie_story_r_work/VPs.tsv")
```

```{r}
# Group by VP_ID and keep only the row with the longest length for each VP_ID
df_longest <- vp_lengths %>% 
  group_by(VP_ID) %>% 
  slice(which.max(length))

# View the resulting dataframe
df_longest
```

```{r}
vps <- left_join(vp_dates_abundances,df_longest, by="VP_ID")
```

```{r}
vps_10kb <- vps[vps$length > 10000, ]
```

```{r}
vps_10kb$VP_ID <- as.character(vps_10kb$VP_ID)
```

```{r}
predicted_ma_vps <- read_tsv("~/Desktop/erie_story_r_work/predicted_ma_virus_vps.tsv")
names(predicted_ma_vps)[names(predicted_ma_vps) == 'cluster'] <- "VP_ID"
predicted_ma_vps$VP_ID <- as.character(predicted_ma_vps$VP_ID)
```

```{r}
vps_10kb_with_ma_viruses <- left_join(vps_10kb,predicted_ma_vps, by="VP_ID")
```

```{r}
vps_10kb_with_ma_viruses <-select(vps_10kb_with_ma_viruses, c('VP_ID', 'rank1percent', 'rankhalfpercent', 'number_dates.x', 'length', 'Length'))
```

```{r}
vps_10kb_with_ma_viruses$Length[is.na(vps_10kb_with_ma_viruses$Length)] <- 0
```


```{r}
# Create scatterplot
ggplot(filter(vps_10kb, rankhalfpercent != 0), aes(x = number_dates, y = rankhalfpercent)) +
  geom_jitter(width = 0.2, height = 0.2, size = 3, alpha = 0.8) +
  labs(x = "Number of Dates Present", y = "Number of Samples Where Abundant")
```

```{r}
ggplot(filter(vps_10kb_with_ma_viruses, rankhalfpercent != 0), aes(x = number_dates.x, y = rankhalfpercent, color = Length > 0, label = ifelse(Length > 0, VP_ID, ""))) +
  geom_jitter(width = 0.2, height = 0.2, size = 3, alpha = 0.8) +
  scale_color_manual(values = c("black", "green")) +
  labs(x = "Number of Dates Present", y = "Number of Samples Where Abundant") +
  theme_classic() +
  geom_text(hjust = 1.2, size = 3)
```

```{r}
library(ggplot2)
library(ggrepel)

ggplot(filter(vps_10kb_with_ma_viruses, rankhalfpercent != 0), aes(x = number_dates.x, y = rankhalfpercent)) +
  geom_jitter(width = 0.2, height = 0.2, size = 3, alpha = 0.8,
              aes(color = ifelse(Length > 0, "Length > 0", "Length = 0"))) +
  scale_color_manual(values = c("Length > 0" = "green", "Length = 0" = "black")) +
  labs(x = "Number of Dates Present", y = "Number of Samples Where Abundant") +
  geom_text_repel(aes(label = VP_ID), nudge_x = 0.1, nudge_y = 0.1, color = "black")

```


```{r}
# Create scatterplot
vp_plot <- ggplot(filter(vps_10kb_with_ma_viruses, rankhalfpercent != 0), aes(x = number_dates.x, y = rankhalfpercent)) +
  geom_jitter(width = 0.2, height = 0.2, size = 6, alpha = 0.6, aes(color = Length > 0)) +
  scale_color_manual(values = c("grey", "green4")) +
  labs(x = "Number of Dates Present", y = "Number of Samples Where Abundant") +
  geom_text(aes(label = ifelse(VP_ID == "Cluster_4", "Ma-LEM01", "")), size = 3, vjust = -4, hjust = -1, color = "black") +
  theme_classic()

vp_plot
```


```{r}
library(dplyr)
library(ggrepel)

# Filter the data points with non-zero rankhalfpercent
filtered_data <- filter(vps_10kb_with_ma_viruses, rankhalfpercent != 0)

# Select the 10 data points with the highest rankhalfpercent values
top_10_data <- filtered_data %>%
  top_n(10, rankhalfpercent)

# Create the scatterplot
vp_plot <- ggplot(filtered_data, aes(x = number_dates.x, y = rankhalfpercent)) +
  geom_jitter(width = 0.2, height = 0.2, size = 4, alpha = 0.6, aes(color = Length > 0)) +
  scale_color_manual(values = c("grey", "green4")) +
  labs(x = "Number of Dates Present", y = "Number of Samples Where Abundant") +
  geom_text_repel(data = top_10_data, aes(label = ifelse(rankhalfpercent %in% top_10_data$rankhalfpercent, VP_ID, "")), 
                  size = 3, color = "black") +
  theme_classic()

vp_plot

```

```{r}
png("~/Desktop/erie_story_r_work/vp_presence_abundance_5_13_23.png", width=8, height=5, units="in", res=300)
vp_plot     
dev.off()
```

```{r}
pdf("~/Desktop/erie_story_r_work/vp_presence_abundance_5_13_23.pdf", width=8, height=5)
vp_plot     
dev.off()
```

#for >3kb vps
##found in at least 10% of samples
```{r}
presence_of_all_vps <- subset(vps, samples_present_in >= 4)
```

##get those that are present and abundant
```{r}
presence_all_vps_half_percent <- subset(presence_of_all_vps, rankhalfpercent != 0)
```

##look for trends of these by combining again with metadata
```{r}
presence_all_vps_half_percent$samples <- sub("^([0-9]+).*", "\\1", presence_all_vps_half_percent$contig)

```

##now bind with metadata
```{r}
metadata <- read_tsv("~/Desktop/erie_story_r_work/2014_story_metadata_updated_12_15_21.tsv")
names(metadata)[names(metadata) == 'samples'] <- "samples"
metadata$samples <- gsub("Sample_","",metadata$samples)
```

```{r}
present_abundant_vps_with_metadata <- left_join(presence_all_vps_half_percent,metadata,by="samples")
```

##clean up data frame to remove rows with incomplete data
```{r}
# assuming your data frame is named df
present_abundant_vps_with_metadata <- subset(present_abundant_vps_with_metadata, VP_ID != "Cluster_6814")

present_abundant_vps_with_metadata <- subset(present_abundant_vps_with_metadata, VP_ID != "samples")
```

##count number of instances of a few different metadata values to look for trends
```{r}
# assuming your data frame is named df
table(present_abundant_vps_with_metadata$fraction)
table(present_abundant_vps_with_metadata$Station)
table(present_abundant_vps_with_metadata$Date)
```



for 10kb vps
```{r}

half_percent_vps <- subset(vps_10kb_with_ma_viruses, rankhalfpercent != 0)

```

```{r}
count_half_percent_ma_vps <- subset(half_percent_vps, Length != 0)
```

to pull samples tpm results specifically and transpose them 

```{r}
selected_rows <- merged_tpm[merged_tpm$samples %in% c("49628", "49630", "49631", "49641"), ]
```

```{r}
# Transpose the selected rows
transposed_samples <- t(selected_rows)

# Convert transposed matrix to a data frame
transposed_samples <- as.data.frame(transposed_samples, stringsAsFactors = FALSE)

# Set the column names
colnames(transposed_samples) <- transposed_samples["samples", ]
transposed_samples <- transposed_samples[-"samples", ]
```

```{r}
transposed_samples <- apply(transposed_samples, 2, function(x) x[order(-x)])
```

###try rank abundance curve of VPs > 3kb
```{r}
vp_3kb_ranks <- vps %>% arrange(desc(read_abundance))


vp_3kb_ranks <- vp_3kb_ranks %>% mutate(rank = row_number())

# remove samples row and spike in row that were present in all 36 samples
vp_3kb_ranks <- vp_3kb_ranks[-c(1, 2), ]

```

###try rank abundance curve of VPs > 10kb

```{r}
vp_10kb_ranks <- vps_10kb %>% arrange(desc(read_abundance))


vp_10kb_ranks <- vp_10kb_ranks %>% mutate(rank = row_number())


```

##plot

```{r}
ggplot(vp_3kb_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  scale_y_log10() +
  theme_classic() +
  theme(axis.title = element_text(size = 18),
        axis.text = element_text(size = 14))

```

```{r}
# Set the threshold for active viruses (adjust as desired)
threshold <- 1

# Filter data frame for active viruses
active_viruses <- subset(vp_3kb_ranks, rankhalfpercent >= threshold)

# Count the number of abundant viruses and number of dates they are present in
active_virus_count <- aggregate(read_abundance ~ number_dates, data = active_viruses, FUN = length)

# Print the counts of active viruses in each date
print(active_virus_count)

```

#now lets get the number of abundant vps per specific sampling date
```{r}
active_viruses$samples <- sub("^([0-9]+).*", "\\1", active_viruses$contig)
```

```{r}
active_viruses_with_metadata <- left_join(active_viruses,metadata,by="samples")
```

```{r}
table(active_viruses_with_metadata$fraction)
table(active_viruses_with_metadata$Station)
table(active_viruses_with_metadata$Date)
```


#now lets get the number of total vps per specific sampling date
```{r}
vps$samples <- sub("^([0-9]+).*", "\\1", vps$contig)
```

```{r}
vps_with_metadata <- left_join(vps,metadata,by="samples")
```

```{r}
table(vps_with_metadata$fraction)
table(vps_with_metadata$Station)
table(vps_with_metadata$Date)
```


#plot all of this

#create percentages vector
```{r}
active_percent <- table(active_viruses_with_metadata$Date) / table(vps_with_metadata$Date) * 100
```

#create data frame for percentages
```{r}
active_vp_percents <- data.frame(Date = names(active_percent), Active_Percentage = active_percent)

colnames(active_vp_percents)[2] <- "active_virus_percentage"
colnames(active_vp_percents)[3] <- "non_active_virus_percentage"

active_vp_percents <- active_vp_percents[-2]

colnames(active_vp_percents)[2] <- "active_virus_percentage"

active_vp_percents$non_active_virus_percentage <- 100 - active_vp_percents$active_virus_percentage

```

```{r}

active_vp_percents$Date <- factor(active_vp_percents$Date, levels=c("8-Jul-14", "21-Jul-14", "29-Jul-14", "4-Aug-14", "25-Aug-14", "8-Sep-14", "23-Sep-14", "29-Sep-14", "6-Oct-14", "20-Oct-14", "27-Oct-14" ))

plot <- ggplot(active_vp_percents, aes(x = Date, y = active_virus_percentage)) +
  geom_bar(stat = "identity", fill = "darkblue") +
  xlab("Sampling Date") +
  ylab("Active Virus Percentage") +
  ggtitle("Active Virus Percentage by Date") +
  theme_minimal() +
  scale_y_continuous(limits = c(0, 100))

plot

```


```{r}
library(ggplot2)

plot <- ggplot(active_vp_percents, aes(x = Date)) +
  geom_bar(aes(y = active_virus_percentage), fill = "purple", stat = "identity") +
  geom_bar(aes(y = 100, height = non_active_virus_percentage), fill = "lightgray", stat = "identity", alpha = 0.3) +
  xlab("Sampling Date") +
  ylab("% of Total Viral Populations") +
  ggtitle("Abundant and Non-Abundant VP Percentage by Date") +
  theme_classic() +
  theme(axis.title = element_text(size = 18),
        axis.text = element_text(size = 14)) +
  scale_y_continuous(limits = c(0, 100))

plot

```

```{r}
library(ggplot2)

plot <- ggplot(active_vp_percents, aes(x = Date)) +
  geom_bar(aes(y = active_virus_percentage), fill = "purple", stat = "identity") +
  geom_bar(aes(y = 100, height = non_active_virus_percentage), fill = "lightgray", stat = "identity", alpha = 0.3) +
  geom_text(aes(y = active_virus_percentage, label = round(active_virus_percentage, 1)), vjust = -0.5, size = 4) +
  xlab("Sampling Date") +
  ylab("% of Total Viral Populations") +
  ggtitle("Abundant and Non-Abundant VP Percentage by Date") +
  theme_classic() +
  theme(axis.title = element_text(size = 18),
        axis.text = element_text(size = 14)) +
  scale_y_continuous(limits = c(0, 100))

plot

```

```{r}
library(ggplot2)

plot <- ggplot(active_vp_percents, aes(x = Date)) +
  geom_bar(aes(y = active_virus_percentage, fill = "Abundant VPs"), stat = "identity") +
  geom_bar(aes(y = 100, height = non_active_virus_percentage, fill = "Non-Abundant VPs"), stat = "identity", alpha = 0.3) +
  geom_text(aes(y = active_virus_percentage, label = round(active_virus_percentage, 1)), vjust = -0.5, size = 4) +
  xlab("Sampling Date") +
  ylab("% of Total Viral Populations") +
  ggtitle("Abundant and Non-Abundant VP Percentage by Date") +
  theme_classic() +
  theme(axis.title = element_text(size = 18),
        axis.text = element_text(size = 14),
        legend.text = element_text(size = 14)) +
  scale_y_continuous(limits = c(0, 100)) +
  scale_fill_manual(values = c("purple", "lightgray"), name = "VPs", labels = c("Abundant VPs", "Non-Abundant VPs"))

plot

```

###now lets try making rank abundance curves for >3kb contigs and >10kb contigs for each fraction of a given date--lets only use the dates with viromes i.e. 8 July, 4 August, 29 September, 27 October


#start by getting all vps, their sample number, and the corresponding metadata
```{r}
vps$samples <- sub("^([0-9]+).*", "\\1", vps$contig)
```

```{r}
vps_with_metadata <- left_join(vps,metadata,by="samples")
```

```{r}
table(vps_with_metadata$fraction)
table(vps_with_metadata$Station)
table(vps_with_metadata$Date)
```

#now lets filter to all those over 3kb before separating by fraction and creating a rank system
```{r}
vps_three_kb <- vps[vps$length > 3000, ]
```

#while we are at it, lets do the same for 10kb
```{r}
vps_ten_kb <- vps[vps$length > 10000, ]
```

#now lets create a separate data frame for each date and their respective fractions--must add metadata
```{r}
vps_three_kb_metadata <- left_join(vps_three_kb,metadata,by="samples")
```

#july_8
```{r}
july_8_three_kb_metadata <- vps_three_kb_metadata[vps_three_kb_metadata$Date=="8-Jul-14",]

july_8_three_kb_metadata <- subset(july_8_three_kb_metadata, Station == "WLE12")

july_8_three_kb_metadata <- july_8_three_kb_metadata[july_8_three_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
july_8_3kb_viral <- july_8_three_kb_metadata[july_8_three_kb_metadata$fraction=="Viral",]

july_8_3kb_whole <- july_8_three_kb_metadata[july_8_three_kb_metadata$fraction=="Whole",]
```

#now create ranks for each fraction df
```{r}
july_8_3kb_viral <- july_8_3kb_viral %>% arrange(desc(read_abundance))
july_8_3kb_viral_ranks <- july_8_3kb_viral %>% mutate(rank = row_number())

july_8_3kb_whole <- july_8_3kb_whole %>% arrange(desc(read_abundance))
july_8_3kb_whole_ranks <- july_8_3kb_whole %>% mutate(rank = row_number())
```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(july_8_3kb_viral_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("July 8 >3kb viral fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(july_8_3kb_whole_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("July 8 >3kb whole fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```



#august 4
```{r}
august_4_three_kb_metadata <- vps_three_kb_metadata[vps_three_kb_metadata$Date=="4-Aug-14",]

august_4_three_kb_metadata <- subset(august_4_three_kb_metadata, Station == "WLE12")

august_4_three_kb_metadata <- august_4_three_kb_metadata[august_4_three_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
august_4_3kb_viral <- august_4_three_kb_metadata[august_4_three_kb_metadata$fraction=="Viral",]

august_4_3kb_whole <- august_4_three_kb_metadata[august_4_three_kb_metadata$fraction=="Whole",]

august_4_3kb_3 <- august_4_three_kb_metadata[august_4_three_kb_metadata$fraction=="3",]

august_4_3kb_53 <- august_4_three_kb_metadata[august_4_three_kb_metadata$fraction=="53",]
```

#now create ranks for each fraction df
```{r}
august_4_3kb_viral <- august_4_3kb_viral %>% arrange(desc(read_abundance))
august_4_3kb_viral_ranks <- august_4_3kb_viral %>% mutate(rank = row_number())

august_4_3kb_whole <- august_4_3kb_whole %>% arrange(desc(read_abundance))
august_4_3kb_whole_ranks <- august_4_3kb_whole %>% mutate(rank = row_number())

august_4_3kb_3 <- august_4_3kb_3 %>% arrange(desc(read_abundance))
august_4_3kb_3_ranks <- august_4_3kb_3 %>% mutate(rank = row_number())

august_4_3kb_53 <- august_4_3kb_53 %>% arrange(desc(read_abundance))
august_4_3kb_53_ranks <-august_4_3kb_53 %>% mutate(rank = row_number())
```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(august_4_3kb_viral_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("August >3kb viral fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(august_4_3kb_whole_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("August 4 >3kb whole fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(august_4_3kb_3_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("August 4 >3kb 3um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(august_4_3kb_53_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("August 4 >3kb 53um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```




#september 29
```{r}
september_29_three_kb_metadata <- vps_three_kb_metadata[vps_three_kb_metadata$Date=="29-Sep-14",]

september_29_three_kb_metadata <- subset(september_29_three_kb_metadata, Station == "WLE12")

september_29_three_kb_metadata <- september_29_three_kb_metadata[september_29_three_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
september_29_3kb_viral <- september_29_three_kb_metadata[september_29_three_kb_metadata$fraction=="Viral",]

september_29_3kb_whole <- september_29_three_kb_metadata[september_29_three_kb_metadata$fraction=="Whole",]

september_29_3kb_3 <- september_29_three_kb_metadata[september_29_three_kb_metadata$fraction=="3",]

september_29_3kb_53 <- september_29_three_kb_metadata[september_29_three_kb_metadata$fraction=="53",]

september_29_3kb_100 <- september_29_three_kb_metadata[september_29_three_kb_metadata$fraction=="100",]
```

#now create ranks for each fraction df
```{r}
september_29_3kb_viral <- september_29_3kb_viral %>% arrange(desc(read_abundance))
september_29_3kb_viral_ranks <- september_29_3kb_viral %>% mutate(rank = row_number())

september_29_3kb_whole <- september_29_3kb_whole %>% arrange(desc(read_abundance))
september_29_3kb_whole_ranks <- september_29_3kb_whole %>% mutate(rank = row_number())

september_29_3kb_3 <- september_29_3kb_3 %>% arrange(desc(read_abundance))
september_29_3kb_3_ranks <- september_29_3kb_3 %>% mutate(rank = row_number())

september_29_3kb_53 <- september_29_3kb_53 %>% arrange(desc(read_abundance))
september_29_3kb_53_ranks <-september_29_3kb_53 %>% mutate(rank = row_number())

september_29_3kb_100 <- september_29_3kb_100 %>% arrange(desc(read_abundance))
september_29_3kb_100_ranks <-september_29_3kb_100 %>% mutate(rank = row_number())
```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(september_29_3kb_viral_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 29 >3kb viral fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(september_29_3kb_whole_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 29 >3kb whole fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(september_29_3kb_3_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 29 >3kb 3um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(september_29_3kb_53_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 29 >3kb 53um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(september_29_3kb_100_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 29 >3kb 100um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

#october 27
```{r}
october_27_three_kb_metadata <- vps_three_kb_metadata[vps_three_kb_metadata$Date=="27-Oct-14",]

october_27_three_kb_metadata <- subset(october_27_three_kb_metadata, Station == "WLE12")

october_27_three_kb_metadata <- october_27_three_kb_metadata[october_27_three_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
october_27_3kb_viral <- october_27_three_kb_metadata[october_27_three_kb_metadata$fraction=="Viral",]

october_27_3kb_whole <- october_27_three_kb_metadata[october_27_three_kb_metadata$fraction=="Whole",]
```

#now create ranks for each fraction df
```{r}
october_27_3kb_viral <- october_27_3kb_viral %>% arrange(desc(read_abundance))
october_27_3kb_viral_ranks <- october_27_3kb_viral %>% mutate(rank = row_number())

october_27_3kb_whole <- october_27_3kb_whole %>% arrange(desc(read_abundance))
october_27_3kb_whole_ranks <- october_27_3kb_whole %>% mutate(rank = row_number())
```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(october_27_3kb_viral_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("October 27 >3kb viral fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(october_27_3kb_whole_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("October 27 >3kb whole fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```






#now lets do 10kb racs

#now lets create a separate data frame for each date and their respective fractions--must add metadata
```{r}
vps_ten_kb_metadata <- left_join(vps_ten_kb,metadata,by="samples")
```

#july_8
```{r}
july_8_ten_kb_metadata <- vps_ten_kb_metadata[vps_ten_kb_metadata$Date=="8-Jul-14",]

july_8_ten_kb_metadata <- subset(july_8_ten_kb_metadata, Station == "WLE12")

july_8_ten_kb_metadata <- july_8_ten_kb_metadata[july_8_ten_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
july_8_10kb_viral <- july_8_ten_kb_metadata[july_8_ten_kb_metadata$fraction=="Viral",]

july_8_10kb_whole <- july_8_ten_kb_metadata[july_8_ten_kb_metadata$fraction=="Whole",]
```

#now create ranks for each fraction df
```{r}
july_8_10kb_viral <- july_8_10kb_viral %>% arrange(desc(read_abundance))
july_8_10kb_viral_ranks <- july_8_10kb_viral %>% mutate(rank = row_number())

july_8_10kb_whole <- july_8_10kb_whole %>% arrange(desc(read_abundance))
july_8_10kb_whole_ranks <- july_8_10kb_whole %>% mutate(rank = row_number())
```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(july_8_10kb_viral_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("July 8 >10kb viral fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(july_8_10kb_whole_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("July 8 >10kb whole fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```



#august 4
```{r}
august_4_ten_kb_metadata <- vps_ten_kb_metadata[vps_ten_kb_metadata$Date=="4-Aug-14",]

august_4_ten_kb_metadata <- subset(august_4_ten_kb_metadata, Station == "WLE12")

august_4_ten_kb_metadata <- august_4_ten_kb_metadata[august_4_ten_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
august_4_10kb_viral <- august_4_ten_kb_metadata[august_4_ten_kb_metadata$fraction=="Viral",]

august_4_10kb_whole <- august_4_ten_kb_metadata[august_4_ten_kb_metadata$fraction=="Whole",]

august_4_10kb_3 <- august_4_ten_kb_metadata[august_4_ten_kb_metadata$fraction=="3",]

august_4_10kb_53 <- august_4_ten_kb_metadata[august_4_ten_kb_metadata$fraction=="53",]
```

#now create ranks for each fraction df
```{r}
august_4_10kb_viral <- august_4_10kb_viral %>% arrange(desc(read_abundance))
august_4_10kb_viral_ranks <- august_4_10kb_viral %>% mutate(rank = row_number())

august_4_10kb_whole <- august_4_10kb_whole %>% arrange(desc(read_abundance))
august_4_10kb_whole_ranks <- august_4_10kb_whole %>% mutate(rank = row_number())

august_4_10kb_3 <- august_4_10kb_3 %>% arrange(desc(read_abundance))
august_4_10kb_3_ranks <- august_4_10kb_3 %>% mutate(rank = row_number())

august_4_10kb_53 <- august_4_10kb_53 %>% arrange(desc(read_abundance))
august_4_10kb_53_ranks <-august_4_10kb_53 %>% mutate(rank = row_number())
```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(august_4_10kb_viral_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("August >10kb viral fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(august_4_10kb_whole_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("August 4 >10kb whole fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(august_4_10kb_3_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("August 4 >10kb 3um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(august_4_10kb_53_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("August 4 >10kb 53um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```




#september 29
```{r}
september_29_ten_kb_metadata <- vps_ten_kb_metadata[vps_ten_kb_metadata$Date=="29-Sep-14",]

september_29_ten_kb_metadata <- subset(september_29_ten_kb_metadata, Station == "WLE12")

september_29_ten_kb_metadata <- september_29_ten_kb_metadata[september_29_ten_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
september_29_10kb_viral <- september_29_ten_kb_metadata[september_29_ten_kb_metadata$fraction=="Viral",]

september_29_10kb_whole <- september_29_ten_kb_metadata[september_29_ten_kb_metadata$fraction=="Whole",]

september_29_10kb_3 <- september_29_ten_kb_metadata[september_29_ten_kb_metadata$fraction=="3",]

september_29_10kb_53 <- september_29_ten_kb_metadata[september_29_ten_kb_metadata$fraction=="53",]

september_29_10kb_100 <- september_29_ten_kb_metadata[september_29_ten_kb_metadata$fraction=="100",]
```

#now create ranks for each fraction df
```{r}
september_29_10kb_viral <- september_29_10kb_viral %>% arrange(desc(read_abundance))
september_29_10kb_viral_ranks <- september_29_10kb_viral %>% mutate(rank = row_number())

september_29_10kb_whole <- september_29_10kb_whole %>% arrange(desc(read_abundance))
september_29_10kb_whole_ranks <- september_29_10kb_whole %>% mutate(rank = row_number())

september_29_10kb_3 <- september_29_10kb_3 %>% arrange(desc(read_abundance))
september_29_10kb_3_ranks <- september_29_10kb_3 %>% mutate(rank = row_number())

september_29_10kb_53 <- september_29_10kb_53 %>% arrange(desc(read_abundance))
september_29_10kb_53_ranks <-september_29_10kb_53 %>% mutate(rank = row_number())

september_29_10kb_100 <- september_29_10kb_100 %>% arrange(desc(read_abundance))
september_29_10kb_100_ranks <-september_29_10kb_100 %>% mutate(rank = row_number())
```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(september_29_10kb_viral_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 29 >10kb viral fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(september_29_10kb_whole_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 29 >10kb whole fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(september_29_10kb_3_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 29 >10kb 3um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(september_29_10kb_53_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 29 >10kb 53um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(september_29_10kb_100_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 29 >10kb 100um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

#october 27
```{r}
october_27_ten_kb_metadata <- vps_ten_kb_metadata[vps_ten_kb_metadata$Date=="27-Oct-14",]

october_27_ten_kb_metadata <- subset(october_27_ten_kb_metadata, Station == "WLE12")

october_27_ten_kb_metadata <- october_27_ten_kb_metadata[october_27_ten_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
october_27_10kb_viral <- october_27_ten_kb_metadata[october_27_ten_kb_metadata$fraction=="Viral",]

october_27_10kb_whole <- october_27_ten_kb_metadata[october_27_ten_kb_metadata$fraction=="Whole",]
```

#now create ranks for each fraction df
```{r}
october_27_10kb_viral <- october_27_10kb_viral %>% arrange(desc(read_abundance))
october_27_10kb_viral_ranks <- october_27_10kb_viral %>% mutate(rank = row_number())

october_27_10kb_whole <- october_27_10kb_whole %>% arrange(desc(read_abundance))
october_27_10kb_whole_ranks <- october_27_10kb_whole %>% mutate(rank = row_number())
```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(october_27_10kb_viral_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("October 27 >10kb viral fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

```{r}
library(ggplot2)
library(scales)

ggplot(october_27_10kb_whole_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("October 27 >10kb whole fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```




#and just to be thorough, lets do some dates where samples were collected for station 12, but not viromes

#august 25
```{r}
august_25_three_kb_metadata <- vps_three_kb_metadata[vps_three_kb_metadata$Date=="25-Aug-14",]

august_25_three_kb_metadata <- subset(august_25_three_kb_metadata, Station == "WLE12")

august_25_three_kb_metadata <- august_25_three_kb_metadata[august_25_three_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
august_25_3kb_100 <- august_25_three_kb_metadata[august_25_three_kb_metadata$fraction=="100",]

```

#now create ranks for each fraction df
```{r}
august_25_3kb_100 <- august_25_3kb_100 %>% arrange(desc(read_abundance))
august_25_3kb_100_ranks <- august_25_3kb_100 %>% mutate(rank = row_number())

```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(august_25_3kb_100_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("August 25 >3kb 100um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

#august 25
```{r}
august_25_ten_kb_metadata <- vps_ten_kb_metadata[vps_ten_kb_metadata$Date=="25-Aug-14",]

august_25_ten_kb_metadata <- subset(august_25_ten_kb_metadata, Station == "WLE12")

august_25_ten_kb_metadata <- august_25_ten_kb_metadata[august_25_ten_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
august_25_10kb_100 <- august_25_ten_kb_metadata[august_25_ten_kb_metadata$fraction=="100",]

```

#now create ranks for each fraction df
```{r}
august_25_10kb_100 <- august_25_10kb_100 %>% arrange(desc(read_abundance))
august_25_10kb_100_ranks <- august_25_10kb_100 %>% mutate(rank = row_number())

```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(august_25_10kb_100_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("August 25 >10kb 100um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```



#september 23
```{r}
september_23_three_kb_metadata <- vps_three_kb_metadata[vps_three_kb_metadata$Date=="23-Sep-14",]

september_23_three_kb_metadata <- subset(september_23_three_kb_metadata, Station == "WLE12")

september_23_three_kb_metadata <- september_23_three_kb_metadata[september_23_three_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
september_23_3kb_100 <- september_23_three_kb_metadata[september_23_three_kb_metadata$fraction=="100",]

```

#now create ranks for each fraction df
```{r}
september_23_3kb_100 <- september_23_3kb_100 %>% arrange(desc(read_abundance))
september_23_3kb_100_ranks <- september_23_3kb_100 %>% mutate(rank = row_number())

```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(september_23_3kb_100_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 23 >3kb 100um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

#september 23
```{r}
september_23_ten_kb_metadata <- vps_ten_kb_metadata[vps_ten_kb_metadata$Date=="23-Sep-14",]

september_23_ten_kb_metadata <- subset(september_23_ten_kb_metadata, Station == "WLE12")

september_23_ten_kb_metadata <- september_23_ten_kb_metadata[september_23_ten_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
september_23_10kb_100 <- september_23_ten_kb_metadata[september_23_ten_kb_metadata$fraction=="100",]

```

#now create ranks for each fraction df
```{r}
september_23_10kb_100 <- september_23_10kb_100 %>% arrange(desc(read_abundance))
september_23_10kb_100_ranks <- september_23_10kb_100 %>% mutate(rank = row_number())

```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(september_23_10kb_100_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("September 23 >10kb 100um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```




#october 20
```{r}
october_20_three_kb_metadata <- vps_three_kb_metadata[vps_three_kb_metadata$Date=="20-Oct-14",]

october_20_three_kb_metadata <- subset(october_20_three_kb_metadata, Station == "WLE12")

october_20_three_kb_metadata <- october_20_three_kb_metadata[october_20_three_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
october_20_3kb_100 <- october_20_three_kb_metadata[october_20_three_kb_metadata$fraction=="100",]

```

#now create ranks for each fraction df
```{r}
october_20_3kb_100 <- october_20_3kb_100 %>% arrange(desc(read_abundance))
october_20_3kb_100_ranks <- october_20_3kb_100 %>% mutate(rank = row_number())

```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(october_20_3kb_100_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("October 20 >3kb 100um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```

#october 20
```{r}
october_20_ten_kb_metadata <- vps_ten_kb_metadata[vps_ten_kb_metadata$Date=="20-Oct-14",]

october_20_ten_kb_metadata <- subset(october_20_ten_kb_metadata, Station == "WLE12")

october_20_ten_kb_metadata <- october_20_ten_kb_metadata[october_20_ten_kb_metadata$fraction %in% c("Viral", "Whole", "3", "53", "100"),]
```

#now separate by fractions
```{r}
october_20_10kb_100 <- october_20_ten_kb_metadata[october_20_ten_kb_metadata$fraction=="100",]

```

#now create ranks for each fraction df
```{r}
october_20_10kb_100 <- october_20_10kb_100 %>% arrange(desc(read_abundance))
october_20_10kb_100_ranks <- october_20_10kb_100 %>% mutate(rank = row_number())

```

#now plot the fraction racs
```{r}
library(ggplot2)
library(scales)

ggplot(october_20_10kb_100_ranks, aes(x = rank, y = read_abundance)) +
  geom_line(color = "purple", size = 1.5) +
  xlab("Rank") +
  ylab("Log10 Read Abundance") +
  ggtitle("October 20 >10kb 100um fraction RAC") +
  scale_y_continuous(
    trans = "log10",
    breaks = c(0, 10, 100, 1000, 10000, 100000, 1000000),
    labels = comma_format()
  ) +
  theme_classic() +
  theme(
    axis.title = element_text(size = 18),
    axis.text = element_text(size = 14)
  )

```