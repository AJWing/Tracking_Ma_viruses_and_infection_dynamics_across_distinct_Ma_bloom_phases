---
title: "generate_cytoscape_networks_ajw_2_2_23"
author: "A.J Wing"
date: "2023-02-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library("tidyr")
library(readr)
library(dplyr)
library(ggplot2)
library(viridis)
library(ggthemes)
```




#Start Network Creation Here 
#
#
#
#


##read in network file

```{r}
network_connections <- read_delim("~/Desktop/erie_story_r_work/all_erie_viruses_and_known_ma_phages_and_fragments.ntw", delim = " ", col_names = F)
```

##rename columns
```{r}
colnames(network_connections) <- c("Partner_One", "Partner_Two", "Weight")
```

##import custom taxonomy via diamond blastp against Kieft virus database from 2020 manuscript

```{r}
custom_taxonomy <- read_tsv("~/Desktop/erie_story_r_work/all_merged_3000_trimmed_viruses_plus_known_ma_virus_seqs_frags_and_sep_lem_variant.PTT.virus-taxonomy.tsv")
```

##combine custom taxonomy file and network file 

```{r}
names(custom_taxonomy)[names(custom_taxonomy) == 'scaffold'] <- "ref_genome"
```


##remove any duplicate connections

remove any that are duplicates
```{r}
network_connections$Both_Partners <- paste(network_connections$Partner_One,
                                                  network_connections$Partner_Two,
                                                  sep = "--")

```

##rename custom taxonomy file column for merging with network file 

```{r}
names(custom_taxonomy)[names(custom_taxonomy) == 'ref_genome'] <- "Partner_One"
```

##merge files together

```{r}
network_connections_subset_with_custom_taxonomy <- left_join(network_connections,custom_taxonomy,by="Partner_One")

```

##update columns in merged file to reflect custom taxonomy not provided from vcontact2

```{r}
names(network_connections_subset_with_custom_taxonomy)[names(network_connections_subset_with_custom_taxonomy) == 'order'] <- "custom_order"
names(network_connections_subset_with_custom_taxonomy)[names(network_connections_subset_with_custom_taxonomy) == 'family'] <- "custom_family"
names(network_connections_subset_with_custom_taxonomy)[names(network_connections_subset_with_custom_taxonomy) == 'subfamily'] <- "custom_subfamily"
```

##import vcontact2 genome overview file
```{r}
vrhyme_and_good_contigs_taxonomy <- read_csv("~/Desktop/erie_story_r_work/all_erie_viruses_and_known_ma_phages_and_fragments_genome_by_genome_overview.csv")
```

##change column name in vcontact2 taxonomy file for merging

```{r}
names(vrhyme_and_good_contigs_taxonomy)[names(vrhyme_and_good_contigs_taxonomy) == 'Genome'] <- "Partner_One"
```

##add in vcontact2 taxonomic assignment...essentially providing this for reference genomes

```{r}
network_connections_subset_with_custom_taxonomy <- left_join(network_connections_subset_with_custom_taxonomy,vrhyme_and_good_contigs_taxonomy,by="Partner_One")

```

##keep columns of interest

```{r}

network_connections_subset_with_custom_taxonomy_slim <-select(network_connections_subset_with_custom_taxonomy, c('Partner_One', 'Partner_Two', 'Both_Partners', 'Weight', 'custom_order', 'custom_family', 'custom_subfamily', 'VC Status', 'VC', 'VC Size', 'Order', 'Family', 'Genus'))
```

##clean up column names

```{r}

names(network_connections_subset_with_custom_taxonomy_slim)[names(network_connections_subset_with_custom_taxonomy_slim) == 'VC Status'] <- "vc_status"
names(network_connections_subset_with_custom_taxonomy_slim)[names(network_connections_subset_with_custom_taxonomy_slim) == 'VC'] <- "vc"
names(network_connections_subset_with_custom_taxonomy_slim)[names(network_connections_subset_with_custom_taxonomy_slim) == 'VC Size'] <- "vc_size"
names(network_connections_subset_with_custom_taxonomy_slim)[names(network_connections_subset_with_custom_taxonomy_slim) == 'Order'] <- "vc2_order"
names(network_connections_subset_with_custom_taxonomy_slim)[names(network_connections_subset_with_custom_taxonomy_slim) == 'Family'] <- "vc2_family"
names(network_connections_subset_with_custom_taxonomy_slim)[names(network_connections_subset_with_custom_taxonomy_slim) == 'Genus'] <- "vc2_genus"
```



###split network into reference genomes and custom taxonomy predictions to add color 

```{r}

vc2_network_connections_subset_with_custom_taxonomy_slim <- subset(network_connections_subset_with_custom_taxonomy_slim, grepl("~", network_connections_subset_with_custom_taxonomy_slim$Partner_One))

my_predictions_network_connections_subset_with_custom_taxonomy_slim <- subset(network_connections_subset_with_custom_taxonomy_slim, grepl("--", network_connections_subset_with_custom_taxonomy_slim$Partner_One))

my_predictions_network_connections_subset_with_custom_taxonomy_ref_ma_viruses_1 <- subset(network_connections_subset_with_custom_taxonomy_slim, grepl("\\.1_", network_connections_subset_with_custom_taxonomy_slim$Partner_One))

my_predictions_network_connections_subset_with_custom_taxonomy_ref_ma_viruses_2 <- subset(network_connections_subset_with_custom_taxonomy_slim, grepl("\\.2_", network_connections_subset_with_custom_taxonomy_slim$Partner_One))

my_predictions_network_connections_subset_with_custom_taxonomy_slim_sep_variant <- subset(network_connections_subset_with_custom_taxonomy_slim, grepl("september", network_connections_subset_with_custom_taxonomy_slim$Partner_One))

my_predictions_network_connections_subset_with_custom_taxonomy_slim <- rbind(my_predictions_network_connections_subset_with_custom_taxonomy_slim,my_predictions_network_connections_subset_with_custom_taxonomy_ref_ma_viruses_1,my_predictions_network_connections_subset_with_custom_taxonomy_ref_ma_viruses_2,my_predictions_network_connections_subset_with_custom_taxonomy_slim_sep_variant)
```

###add color to vc2 taxonomy --this will be target node color
```{r}
vc2_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color <- "gray"
vc2_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[vc2_network_connections_subset_with_custom_taxonomy_slim$vc2_family=="Microviridae"] <- "red"
vc2_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[vc2_network_connections_subset_with_custom_taxonomy_slim$vc2_family=="Siphoviridae"] <- "pink"
vc2_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[vc2_network_connections_subset_with_custom_taxonomy_slim$vc2_family=="Myoviridae"] <- "green"
vc2_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[vc2_network_connections_subset_with_custom_taxonomy_slim$vc2_family=="Podoviridae"] <- "purple"
vc2_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[vc2_network_connections_subset_with_custom_taxonomy_slim$vc2_family=="Unassigned"] <- "gray"

```

###add border width to nodes --this will be source node border width

```{r}

vc2_network_connections_subset_with_custom_taxonomy_slim$consensus_source_border_width <- "1"

```


###add color to vc2 taxonomy --this will be target node color
```{r}
my_predictions_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color <- "gray"
my_predictions_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[my_predictions_network_connections_subset_with_custom_taxonomy_slim$custom_family=="Ackermannviridae"] <- "yellow"
my_predictions_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[my_predictions_network_connections_subset_with_custom_taxonomy_slim$custom_family=="ambiguous"] <- "gray"
my_predictions_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[my_predictions_network_connections_subset_with_custom_taxonomy_slim$custom_family=="Herelleviridae"] <- "orange"
my_predictions_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[my_predictions_network_connections_subset_with_custom_taxonomy_slim$custom_family=="Microviridae"] <- "red"
my_predictions_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[my_predictions_network_connections_subset_with_custom_taxonomy_slim$custom_family=="Myoviridae"] <- "green"
my_predictions_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[my_predictions_network_connections_subset_with_custom_taxonomy_slim$custom_family=="Podoviridae"] <- "purple"
my_predictions_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[my_predictions_network_connections_subset_with_custom_taxonomy_slim$custom_family=="Siphoviridae"] <- "pink"
my_predictions_network_connections_subset_with_custom_taxonomy_slim$consensus_source_color[my_predictions_network_connections_subset_with_custom_taxonomy_slim$custom_family=="unknown"] <- "gray"

```

```{r}

my_predictions_network_connections_subset_with_custom_taxonomy_slim$consensus_source_border_width <- "15"

```
##merge these newly colored and previously separated networks
```{r}
network_connections_subset_with_custom_taxonomy_slim_refined <- rbind(my_predictions_network_connections_subset_with_custom_taxonomy_slim,vc2_network_connections_subset_with_custom_taxonomy_slim)
```

###filter by station/fraction

```{r}
network_connections_subset_with_custom_taxonomy_slim_refined$Both_Partners <- sub("--k141.*", "", network_connections_subset_with_custom_taxonomy_slim_refined$Both_Partners)
network_connections_subset_with_custom_taxonomy_slim_refined$Both_Partners <- sub("_vRhyme.*", "", network_connections_subset_with_custom_taxonomy_slim_refined$Both_Partners)
names(network_connections_subset_with_custom_taxonomy_slim_refined)[names(network_connections_subset_with_custom_taxonomy_slim_refined) == 'Both_Partners'] <- "sample"
```

```{r}
network_connections_subset_with_custom_taxonomy_slim_refined <- left_join(network_connections_subset_with_custom_taxonomy_slim_refined,metadata,by="sample")
```


###write network file for each bloom respectively--no filters

```{r}
write_tsv(network_connections_subset_with_custom_taxonomy_slim_refined, file="~/Desktop/erie_story_r_work/all_erie_viruses_with_reference_viruses_and_taxonomy_2_2_23.ntw", col_names = T)
```


















```{r}
aug_4_network_connections_subset_with_custom_taxonomy_slim_refined <- network_connections_subset_with_custom_taxonomy_slim_refined[network_connections_subset_with_custom_taxonomy_slim_refined$Date=="4-Aug-14",]
wle_2_aug_4_network_connections_subset_with_custom_taxonomy_slim_refined <- aug_4_network_connections_subset_with_custom_taxonomy_slim_refined[aug_4_network_connections_subset_with_custom_taxonomy_slim_refined$Station=="WLE2",]
wle_4_aug_4_network_connections_subset_with_custom_taxonomy_slim_refined <- aug_4_network_connections_subset_with_custom_taxonomy_slim_refined[aug_4_network_connections_subset_with_custom_taxonomy_slim_refined$Station=="WLE4",]
wle_12_aug_4_network_connections_subset_with_custom_taxonomy_slim_refined <- aug_4_network_connections_subset_with_custom_taxonomy_slim_refined[aug_4_network_connections_subset_with_custom_taxonomy_slim_refined$Station=="WLE12",]

sep_29_network_connections_subset_with_custom_taxonomy_slim_refined <- network_connections_subset_with_custom_taxonomy_slim_refined[network_connections_subset_with_custom_taxonomy_slim_refined$Date=="29-Sep-14",]
wle_2_sep_29_network_connections_subset_with_custom_taxonomy_slim_refined <- sep_29_network_connections_subset_with_custom_taxonomy_slim_refined[sep_29_network_connections_subset_with_custom_taxonomy_slim_refined$Station=="WLE2",]
wle_4_sep_29_network_connections_subset_with_custom_taxonomy_slim_refined <- sep_29_network_connections_subset_with_custom_taxonomy_slim_refined[sep_29_network_connections_subset_with_custom_taxonomy_slim_refined$Station=="WLE4",]
wle_12_sep_29_network_connections_subset_with_custom_taxonomy_slim_refined <- sep_29_network_connections_subset_with_custom_taxonomy_slim_refined[sep_29_network_connections_subset_with_custom_taxonomy_slim_refined$Station=="WLE12",]
```


##write network file

```{r}
write_tsv(aug_4_network_connections_subset_with_custom_taxonomy_slim_refined, file="~/Desktop/erie_story_r_work/aug_4_network_connections_subset_with_custom_taxonomy_slim_refined_10_27_22.ntw", col_names = T)
write_tsv(wle_2_aug_4_network_connections_subset_with_custom_taxonomy_slim_refined, file="~/Desktop/erie_story_r_work/wle_2_aug_4_network_connections_subset_with_custom_taxonomy_slim_refined_10_27_22.ntw", col_names = T)
write_tsv(wle_4_aug_4_network_connections_subset_with_custom_taxonomy_slim_refined, file="~/Desktop/erie_story_r_work/wle_4_aug_4_network_connections_subset_with_custom_taxonomy_slim_refined_10_27_22.ntw", col_names = T)
write_tsv(wle_12_aug_4_network_connections_subset_with_custom_taxonomy_slim_refined, file="~/Desktop/erie_story_r_work/wle_12_aug_4_network_connections_subset_with_custom_taxonomy_slim_refined_10_27_22.ntw", col_names = T)
write_tsv(sep_29_network_connections_subset_with_custom_taxonomy_slim_refined, file="~/Desktop/erie_story_r_work/sep_29_network_connections_subset_with_custom_taxonomy_slim_refined_10_27_22.ntw", col_names = T)
write_tsv(wle_2_sep_29_network_connections_subset_with_custom_taxonomy_slim_refined, file="~/Desktop/erie_story_r_work/wle_2_sep_29_network_connections_subset_with_custom_taxonomy_slim_refined_10_27_22.ntw", col_names = T)
write_tsv(wle_4_sep_29_network_connections_subset_with_custom_taxonomy_slim_refined, file="~/Desktop/erie_story_r_work/wle_4_sep_29_network_connections_subset_with_custom_taxonomy_slim_refined_10_27_22.ntw", col_names = T)
write_tsv(wle_12_sep_29_network_connections_subset_with_custom_taxonomy_slim_refined, file="~/Desktop/erie_story_r_work/wle_12_sep_29_network_connections_subset_with_custom_taxonomy_slim_refined_10_27_22.ntw", col_names = T)
```